@using DLForum.Models.Topic
@model List<Topic>

@{
    ViewData["Title"] = "Главная страница";
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/css/home_style.css">
<link rel="stylesheet" type="text/css" href="/css/loader_style.css">

@if (TempData["SuccessMessage"] != null)
{
    <div id="custom-toast" class="custom-toast show">
        <div class="toast-icon"><i class="bi bi-check-circle-fill"></i></div>
        <div class="toast-content">@TempData["SuccessMessage"]</div>
        <button type="button" class="toast-close" onclick="closeToast()">&times;</button>
    </div>
    <script>
        setTimeout(() => {
            document.getElementById('custom-toast')?.classList.remove('show');
        }, 3500);
        function closeToast() {
            document.getElementById('custom-toast').classList.remove('show');
        }
    </script>
}

<div class="container mt-4">
    <div class="row">
        <!-- Боковая панель слева -->
        <div class="col-md-3 d-none d-md-block">
            <nav class="nav-menu">
                <div class="menu-item">
                    <a asp-action="index" asp-controller="home" class="menu-link">
                        <i class="bi bi-house-door-fill"></i>
                        <span>Главная</span>
                    </a>
                </div>

                <div class="menu-item">
                    <a href="#" data-url="/home/popular" class="menu-link">
                        <i class="bi bi-star-fill"></i>
                        <span>Популярное</span>
                    </a>
                </div>

                <div class="menu-item">
                    <button class="menu-link categories-toggle" data-bs-toggle="collapse" data-bs-target="#categoriesMenu">
                        <div class="d-flex align-items-center justify-content-between w-100">
                            <div>
                                <i class="bi bi-grid-3x3-gap-fill"></i>
                                <span>Категории</span>
                            </div>
                            <i class="bi bi-chevron-down"></i>
                        </div>
                    </button>
                    
                    <div class="collapse categories-menu" id="categoriesMenu">
                        <button class="category-item" onclick="loadContent('/home/categories?category=Новости')">
                            <i class="bi bi-newspaper"></i>
                            <span>Новости</span>
                        </button>
                        <button class="category-item" onclick="loadContent('/home/categories?category=Технологии')">
                            <i class="bi bi-cpu"></i>
                            <span>Технологии</span>
                        </button>
                        <button class="category-item" onclick="loadContent('/home/categories?category=Искусство')">
                            <i class="bi bi-palette"></i>
                            <span>Искусство</span>
                        </button>
                        <button class="category-item" onclick="loadContent('/home/categories?category=Наука')">
                            <i class="bi bi-mortarboard"></i>
                            <span>Наука</span>
                        </button>
                        <button class="category-item" onclick="loadContent('/home/categories?category=Образование')">
                            <i class="bi bi-book"></i>
                            <span>Образование</span>
                        </button>
                        <button class="category-item" onclick="loadContent('/home/categories?category=Развлечения')">
                            <i class="bi bi-tv"></i>
                            <span>Развлечения</span>
                        </button>
                        <button class="category-item" onclick="loadContent('/home/categories?category=Спорт')">
                            <i class="bi bi-balloon"></i>
                            <span>Спорт</span>
                        </button>
                        <button class="category-item" onclick="loadContent('/home/categories?category=Музыка')">
                            <i class="bi bi-music-note-list"></i>
                            <span>Музыка</span>
                        </button>
                        <button class="category-item" onclick="loadContent('/home/categories?category=Другое')">
                            <i class="bi bi-archive"></i>
                            <span>Другое</span>
                        </button>
                    </div>
                </div>
            </nav>
        </div>

        <!-- Мобильная навигация -->
        <div class="col-12 d-md-none">
            <div class="card border-0" style="background: var(--background-color);color: var(--text-color)">
                <div class="card-body p-2" style="background: var(--background-color);">
                    <button class="btn btn-dark w-100 d-flex justify-content-between align-items-center" type="button" onclick="loadContent('/home/popular')">
                        <span><i class="bi bi-star-fill me-2"></i>Популярное</span>
                    </button>
                    <button class="btn btn-dark w-100 d-flex justify-content-between align-items-center" type="button" data-bs-toggle="collapse" data-bs-target="#mobileCategoriesDropdown">
                        <span><i class="bi bi-grid-3x3-gap-fill me-2"></i>Категории</span>
                        <i class="bi bi-chevron-down"></i>
                    </button>
                    <div class="collapse mt-2" id="mobileCategoriesDropdown">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-light text-start" onclick="loadContent('/home/categories?category=Новости')">
                                <i class="bi bi-newspaper me-2"></i>Новости
                            </button>
                            <button class="btn btn-outline-light text-start" onclick="loadContent('/home/categories?category=Технологии')">
                                <i class="bi bi-cpu me-2"></i>Технологии
                            </button>
                            <button class="btn btn-outline-light text-start" onclick="loadContent('/home/categories?category=Искусство')">
                                <i class="bi bi-palette me-2"></i>Искусство
                            </button>
                            <button class="btn btn-outline-light text-start" onclick="loadContent('/home/categories?category=Наука')">
                                <i class="bi bi-mortarboard me-2"></i>Наука
                            </button>
                            <button class="btn btn-outline-light text-start" onclick="loadContent('/home/categories?category=Образование')">
                                <i class="bi bi-book me-2"></i>Образование
                            </button>
                            <button class="btn btn-outline-light text-start" onclick="loadContent('/home/categories?category=Развлечения')">
                                <i class="bi bi-tv me-2"></i>Развлечения
                            </button>
                            <button class="btn btn-outline-light text-start" onclick="loadContent('/home/categories?category=Спорт')">
                                <i class="bi bi-balloon me-2"></i>Спорт
                            </button>
                            <button class="btn btn-outline-light text-start" onclick="loadContent('/home/categories?category=Музыка')">
                                <i class="bi bi-music-note-list me-2"></i>Музыка
                            </button>
                            <button class="btn btn-outline-light text-start" onclick="loadContent('/home/categories?category=Другое')">
                                <i class="bi bi-archive me-2"></i>Другое
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <style>
            :root {
                --loader-box-color: #ffffff;
            }

            [data-theme="light"] {
                --loader-box-color: #1a1a1b;
            }

            .banter-loader__box:before {
                content: "";
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background: var(--loader-box-color);
            }
        </style>

        <div class="col-md-6">
            <div id="dynamic-content">
                <div class="banter-loader">
                    <div class="banter-loader__box"></div>
                    <div class="banter-loader__box"></div>
                    <div class="banter-loader__box"></div>
                    <div class="banter-loader__box"></div>
                    <div class="banter-loader__box"></div>
                    <div class="banter-loader__box"></div>
                    <div class="banter-loader__box"></div>
                    <div class="banter-loader__box"></div>
                    <div class="banter-loader__box"></div>
                </div>
            </div>
        </div>

        <!-- Боковая панель справа -->
        <div class="col-md-3 d-none d-md-block">
            <nav class="nav-menu">
                <div class="menu-item">
                    <a href="#" data-url="/home/rules" class="menu-link">
                        <i class="bi bi-shield-shaded"></i>
                        <span>Правила пользования</span>
                    </a>
                </div>
                <div class="menu-item">
                    <a href="#" data-url="/home/privacy" class="menu-link">
                        <i class="bi bi-list"></i>
                        <span>Политика приватности</span>
                    </a>
                </div>
                <div class="mt-4 text-muted">
                    <small>&copy; 2025 DLForum. Все права защищены.</small>
                </div>
            </nav>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        const params = new URLSearchParams(window.location.search);
        const urlToLoad = params.get("load");

        if (urlToLoad) {
            loadContent(urlToLoad);
        } else {
            loadContent('/home');
        }

        // Обработчик для всех ссылок категорий
        $(document).on("click", "[data-url], [onclick*='loadContent']", function (e) {
            e.preventDefault();
            const url = $(this).data("url") || $(this).attr("onclick").match(/loadContent\('([^']+)'\)/)[1];
            
            if (url) {
                loadContent(url);
                // Обновляем URL страницы
                const newUrl = `${window.location.pathname}?load=${encodeURIComponent(url)}`;
                window.history.pushState({ path: newUrl }, '', newUrl);
                
                // Закрываем мобильное меню категорий после выбора
                $("#mobileCategoriesDropdown").collapse('hide');
            }
        });

        function loadContent(url) {
            $("#dynamic-content").html(`
                <div class="banter-loader">
                    <div class="banter-loader__box"></div>
                    <div class="banter-loader__box"></div>
                    <div class="banter-loader__box"></div>
                    <div class="banter-loader__box"></div>
                    <div class="banter-loader__box"></div>
                    <div class="banter-loader__box"></div>
                    <div class="banter-loader__box"></div>
                    <div class="banter-loader__box"></div>
                    <div class="banter-loader__box"></div>
                </div>
            `);

            $.ajax({
                url: url,
                method: 'GET',
                success: function (response) {
                    $("#dynamic-content").html(response).fadeIn(500);
                },
                error: function () {
                    $("#dynamic-content").html("<p>Ошибка загрузки содержимого</p>").fadeIn(500);
                }
            });
        }

        // Глобальная функция для загрузки контента
        window.loadContent = loadContent;
    });
</script>

<!-- Модальное окно для изображения -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-transparent border-0">
            <button type="button" class="btn-close position-absolute top-0 end-0 m-2" data-bs-dismiss="modal" aria-label="Close"></button>
            <img src="" alt="Full-size Image" class="img-fluid rounded">
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const modal = new bootstrap.Modal(document.getElementById("imageModal"));
        const modalImage = document.querySelector("#imageModal img");

        document.body.addEventListener("click", function (event) {
            if (event.target && event.target.classList.contains("thumbnail")) {
                event.stopPropagation();
                const fullSizeImage = event.target.getAttribute("data-fullsize");

                if (fullSizeImage) {
                    modalImage.src = fullSizeImage;
                    modal.show();
                } else {
                    console.error("Отсутствует атрибут data-fullsize у изображения.");
                }
            }
        });
    });
</script>

